{#
  Template written and annotated by GitHub Copilot at the request of Fernando "ferabreu" Mees Abreu.
  See LICENSE file in the project root for full license information.

  Admin categories management page. Displays hierarchical category tree with edit and delete options.
#}

{% extends "base.html" %}

{% import 'macros/category_list.html' as category_list %}

{% block content %}
    <div class="category-row-content">
        <h2 class="mt-3 mb-3">Category Management</h2>
        <a href="{{ url_for('admin.dashboard') }}">&larr; Admin Dashboard</a>
        <a href="{{ url_for('categories.admin_new') }}" class="btn btn-success mb-2">+ Add Category</a>
        <div class="table-responsive admin-table-wrapper mt-3">
            <table class="table admin-table mb-0">
                <thead>
                    <tr>
                        <th></th>
                        <th>Name</th>
                        <th class="text-end">Listings</th>
                    </tr>
                </thead>
                <tbody>
                    {# Render root categories (no parent), sorted by name #}
                    {% for root in categories|selectattr('parent', 'none')|sort(attribute='name') %}
                        {{ category_list.render_category_rows(root, categories, include_admin_ui=True) }}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="d-flex justify-content-start gap-2 mb-3">
            <button type="button" class="btn btn-warning" onclick="handleEdit('{{ url_for('categories.admin_edit', category_id=0) }}'.replace('/0', '/{id}'), 'selected_category_id')">Edit</button>
            <button type="button" class="btn btn-danger" onclick="handleDelete('{{ url_for('categories.admin_delete', category_id=0) }}'.replace('/0', '/{id}'), 'selected_category_id', 'category')">Delete</button>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('static', filename='js/form_selection.js') }}"></script>
{% endblock %}
